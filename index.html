<!DOCTYPE html>
<meta charset="utf-8">
<title>NFD nightly packages</title>
<base target="_blank">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/purecss@2.0.3,npm/purecss@2.0.3/build/grids-responsive-min.min.css">
<style>
a { text-decoration:none; }
html { position:relative; min-height:100%; }
body { padding:0 0.2rem 6rem 0.2rem; }
@media(min-width:980px) { body { padding:0 3rem 6rem 3rem; } }
footer { position:absolute; right:0; bottom:0; left:0; padding:1rem 3rem 1rem 3rem; }
</style>

<section>
<h1>NFD nightly packages</h1>
<p>
This page provides automated builds of <a href="https://named-data.net/doc/NFD/current/">NDN Forwarding Daemon (NFD)</a> and related software.
See <a href="https://yoursunny.com/t/2020/NFD-nightly/">instructions and FAQ</a>.
</p>

<table class="pure-table pure-table-horizontal">
<thead>
<tr>
<th>build</th>
<th>platform</th>
<th>ndn-cxx</th>
<th>NFD</th>
<th>ndn-tools</th>
</tr>
</thead>
<tbody id="table">
<tr id="loading"><td colspan="5">loading</td></tr>
</tbody>
</table>
</section>

<footer>
<p>&copy; yoursunny.com, powered by <a href="https://github.com/yoursunny/NFD-nightly/actions" target="_blank">GitHub Actions</a> and <a href="https://www.balena.io/docs/reference/base-images/base-images-ref/" target="_blank">Balena Docker images</a></p>
</footer>
<script>
function td(text, href) {
  const $td = document.createElement("td");
  if (href) {
    const $a = document.createElement("a");
    $a.href = href;
    $a.textContent = text;
    $td.append($a);
  } else {
    $td.textContent = text;
  }
  return $td;
}

function appendArtifacts(run, artifacts) {
  const suite = run.check_suite_url.split("/").pop();
  const platforms = artifacts.filter(a => a.name.startsWith("ndn-cxx ")).map(a => a.name.slice(8));
  if (platforms.length === 0) {
    return;
  }

  const rows = [];
  for (const platform of platforms) {
    const $tr = document.createElement("tr");
    $tr.append(td(platform));
    for (const proj of ["ndn-cxx", "nfd", "ndn-tools"]) {
      const artifact = artifacts.find(a => a.name === `${proj} ${platform}`);
      if (artifact) {
        const u = `https://github.com/yoursunny/NFD-nightly/suites/${suite}/artifacts/${artifact.id}`;
        $tr.append(td("download", u));
      } else {
        $tr.append(td("missing"))
      }
    }
    rows.push($tr);
  }

  {
    const $td = document.createElement("td");
    $td.rowSpan = platforms.length;
    $td.textContent = run.id;
    const $small = document.createElement("small");
    $small.textContent = run.updated_at;
    $td.append(document.createElement("br"), $small);
    rows[0].prepend($td);
  }

  document.querySelector("#table").append(...rows);

  const $loading = document.querySelector("#loading");
  if ($loading) {
    $loading.remove();
  }
}

(async () => {
  const { workflow_runs } = await fetch("https://api.github.com/repos/yoursunny/NFD-nightly/actions/runs").then(r => r.json());
  for (const run of workflow_runs) {
    if (run.status !== "completed" || run.conclusion !== "success") {
      continue;
    }
    try {
      const { artifacts } = await fetch(run.artifacts_url).then(r => r.json());
      appendArtifacts(run, artifacts);
    } catch (err) {
      console.error(err);
    }
  }
})();
</script>

<script>
(function(e,t,n,i,s,a,c){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)}
;a=t.createElement(i);c=t.getElementsByTagName(i)[0];a.async=true;a.src=s
;c.parentNode.insertBefore(a,c)
})(window,document,"galite","script","https://cdn.jsdelivr.net/npm/ga-lite@2/dist/ga-lite.min.js");
if (location.hostname.endsWith(".ndn.today")) {
  galite("create", "UA-935676-11", "auto");
  galite("send", "pageview");
}
</script>
